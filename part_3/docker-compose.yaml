# ğŸ³ VersiÃ³n del esquema de Docker Compose
version: '3'

# ğŸ”§ DefiniciÃ³n de los servicios que se van a levantar
services:
  # ğŸš€ Servicio principal de la aplicaciÃ³n Node.js
  app:
    build: . # Construye la imagen desde el Dockerfile ubicado en el directorio actual
    container_name: todo-app # Nombre personalizado del contenedor para facilitar identificaciÃ³n

    # ğŸŒ± Variables de entorno necesarias para la app
    environment:
      - DATABASE_URL=postgresql://postgres:postgres@db:5432/todoapp # URL de conexiÃ³n a la base de datos PostgreSQL
      - JWT_SECRET=mi_clave_super_secreta_123 # Clave secreta para firmar tokens JWT
      - NODE_ENV=development # Entorno de ejecuciÃ³n (puede ser development, production, etc.)
      - PORT=5003 # Puerto en el que la app escucha internamente

    # ğŸŒ Mapeo de puertos: expone el puerto 5003 del contenedor al host
    ports:
      - '5003:5003'

    # â›“ï¸ Este servicio depende del servicio "db", lo que garantiza que se intente iniciar despuÃ©s
    depends_on:
      - db

    # ğŸ“ Monta el directorio actual en /app dentro del contenedor (Ãºtil para desarrollo en caliente)
    volumes:
      - .:/app

  # ğŸ—„ï¸ Servicio de base de datos PostgreSQL
  db:
    image: postgres:13-alpine # Imagen ligera de PostgreSQL basada en Alpine Linux
    container_name: postgres-db # Nombre personalizado del contenedor de la base de datos

    # ğŸ” Variables de entorno para inicializar la base de datos
    environment:
      POSTGRES_USER: postgres # Usuario por defecto
      POSTGRES_PASSWORD: postgres # ContraseÃ±a del usuario
      POSTGRES_DB: todoapp # Nombre de la base de datos que se crearÃ¡ al iniciar

    # ğŸŒ Mapeo de puertos: expone el puerto 5432 del contenedor al host
    ports:
      - '5432:5432'

    # ğŸ’¾ Volumen persistente para guardar los datos de PostgreSQL
    volumes:
      - postgres-data:/var/lib/postgresql/data # Monta el volumen en el directorio de datos de PostgreSQL

# ğŸ“¦ DefiniciÃ³n de volÃºmenes persistentes
volumes:
  postgres-data: # Volumen nombrado para persistencia de datos entre reinicios
